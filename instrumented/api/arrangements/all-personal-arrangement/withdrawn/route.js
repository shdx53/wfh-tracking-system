function cov_2honlk984t() {
  var path = "/Users/ongsweelong/Library/CloudStorage/OneDrive-SingaporeManagementUniversity/Y3S1/SPM IS212/Project/wfh-tracking-system/app/api/arrangements/all-personal-arrangement/withdrawn/route.js";
  var hash = "d23d7b99ddfdc25c2921be4655c9f8c3868f990a";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/ongsweelong/Library/CloudStorage/OneDrive-SingaporeManagementUniversity/Y3S1/SPM IS212/Project/wfh-tracking-system/app/api/arrangements/all-personal-arrangement/withdrawn/route.js",
    statementMap: {
      "0": {
        start: {
          line: 7,
          column: 2
        },
        end: {
          line: 116,
          column: 3
        }
      },
      "1": {
        start: {
          line: 9,
          column: 17
        },
        end: {
          line: 9,
          column: 35
        }
      },
      "2": {
        start: {
          line: 10,
          column: 17
        },
        end: {
          line: 10,
          column: 43
        }
      },
      "3": {
        start: {
          line: 13,
          column: 25
        },
        end: {
          line: 13,
          column: 53
        }
      },
      "4": {
        start: {
          line: 14,
          column: 20
        },
        end: {
          line: 14,
          column: 47
        }
      },
      "5": {
        start: {
          line: 15,
          column: 4
        },
        end: {
          line: 15,
          column: 38
        }
      },
      "6": {
        start: {
          line: 18,
          column: 62
        },
        end: {
          line: 18,
          column: 82
        }
      },
      "7": {
        start: {
          line: 21,
          column: 4
        },
        end: {
          line: 26,
          column: 5
        }
      },
      "8": {
        start: {
          line: 22,
          column: 6
        },
        end: {
          line: 25,
          column: 8
        }
      },
      "9": {
        start: {
          line: 29,
          column: 19
        },
        end: {
          line: 36,
          column: 5
        }
      },
      "10": {
        start: {
          line: 39,
          column: 4
        },
        end: {
          line: 45,
          column: 5
        }
      },
      "11": {
        start: {
          line: 40,
          column: 6
        },
        end: {
          line: 40,
          column: 21
        }
      },
      "12": {
        start: {
          line: 41,
          column: 6
        },
        end: {
          line: 44,
          column: 8
        }
      },
      "13": {
        start: {
          line: 49,
          column: 26
        },
        end: {
          line: 55,
          column: 5
        }
      },
      "14": {
        start: {
          line: 57,
          column: 4
        },
        end: {
          line: 63,
          column: 5
        }
      },
      "15": {
        start: {
          line: 58,
          column: 6
        },
        end: {
          line: 58,
          column: 21
        }
      },
      "16": {
        start: {
          line: 59,
          column: 6
        },
        end: {
          line: 62,
          column: 8
        }
      },
      "17": {
        start: {
          line: 65,
          column: 22
        },
        end: {
          line: 65,
          column: 59
        }
      },
      "18": {
        start: {
          line: 68,
          column: 26
        },
        end: {
          line: 71,
          column: 5
        }
      },
      "19": {
        start: {
          line: 72,
          column: 24
        },
        end: {
          line: 72,
          column: 68
        }
      },
      "20": {
        start: {
          line: 74,
          column: 4
        },
        end: {
          line: 80,
          column: 5
        }
      },
      "21": {
        start: {
          line: 75,
          column: 6
        },
        end: {
          line: 75,
          column: 21
        }
      },
      "22": {
        start: {
          line: 76,
          column: 6
        },
        end: {
          line: 79,
          column: 8
        }
      },
      "23": {
        start: {
          line: 82,
          column: 25
        },
        end: {
          line: 82,
          column: 48
        }
      },
      "24": {
        start: {
          line: 85,
          column: 20
        },
        end: {
          line: 85,
          column: 43
        }
      },
      "25": {
        start: {
          line: 86,
          column: 17
        },
        end: {
          line: 90,
          column: 46
        }
      },
      "26": {
        start: {
          line: 93,
          column: 4
        },
        end: {
          line: 102,
          column: 5
        }
      },
      "27": {
        start: {
          line: 94,
          column: 6
        },
        end: {
          line: 94,
          column: 53
        }
      },
      "28": {
        start: {
          line: 95,
          column: 6
        },
        end: {
          line: 95,
          column: 58
        }
      },
      "29": {
        start: {
          line: 97,
          column: 6
        },
        end: {
          line: 97,
          column: 21
        }
      },
      "30": {
        start: {
          line: 98,
          column: 6
        },
        end: {
          line: 101,
          column: 8
        }
      },
      "31": {
        start: {
          line: 106,
          column: 4
        },
        end: {
          line: 106,
          column: 19
        }
      },
      "32": {
        start: {
          line: 109,
          column: 4
        },
        end: {
          line: 112,
          column: 6
        }
      },
      "33": {
        start: {
          line: 115,
          column: 4
        },
        end: {
          line: 115,
          column: 108
        }
      }
    },
    fnMap: {
      "0": {
        name: "PUT",
        decl: {
          start: {
            line: 6,
            column: 22
          },
          end: {
            line: 6,
            column: 25
          }
        },
        loc: {
          start: {
            line: 6,
            column: 35
          },
          end: {
            line: 117,
            column: 1
          }
        },
        line: 6
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 21,
            column: 4
          },
          end: {
            line: 26,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 21,
            column: 4
          },
          end: {
            line: 26,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 21
      },
      "1": {
        loc: {
          start: {
            line: 21,
            column: 8
          },
          end: {
            line: 21,
            column: 60
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 21,
            column: 8
          },
          end: {
            line: 21,
            column: 23
          }
        }, {
          start: {
            line: 21,
            column: 27
          },
          end: {
            line: 21,
            column: 42
          }
        }, {
          start: {
            line: 21,
            column: 46
          },
          end: {
            line: 21,
            column: 60
          }
        }],
        line: 21
      },
      "2": {
        loc: {
          start: {
            line: 39,
            column: 4
          },
          end: {
            line: 45,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 39,
            column: 4
          },
          end: {
            line: 45,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 39
      },
      "3": {
        loc: {
          start: {
            line: 57,
            column: 4
          },
          end: {
            line: 63,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 57,
            column: 4
          },
          end: {
            line: 63,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 57
      },
      "4": {
        loc: {
          start: {
            line: 57,
            column: 8
          },
          end: {
            line: 57,
            column: 52
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 57,
            column: 8
          },
          end: {
            line: 57,
            column: 22
          }
        }, {
          start: {
            line: 57,
            column: 26
          },
          end: {
            line: 57,
            column: 52
          }
        }],
        line: 57
      },
      "5": {
        loc: {
          start: {
            line: 74,
            column: 4
          },
          end: {
            line: 80,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 74,
            column: 4
          },
          end: {
            line: 80,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 74
      },
      "6": {
        loc: {
          start: {
            line: 74,
            column: 8
          },
          end: {
            line: 74,
            column: 48
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 74,
            column: 8
          },
          end: {
            line: 74,
            column: 20
          }
        }, {
          start: {
            line: 74,
            column: 24
          },
          end: {
            line: 74,
            column: 48
          }
        }],
        line: 74
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0
    },
    f: {
      "0": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "d23d7b99ddfdc25c2921be4655c9f8c3868f990a"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_2honlk984t = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_2honlk984t();
import connection from "@/app/lib/db";
import { NextResponse } from "next/server";
import { sendNotification } from "@/app/lib/notificationService.js";

// Example Endpoint: http://localhost:3000/api/requests/update-status
export async function PUT(request) {
  cov_2honlk984t().f[0]++;
  cov_2honlk984t().s[0]++;
  try {
    // Establish the connection using the pool
    const pool = (cov_2honlk984t().s[1]++, await connection());
    const conn = (cov_2honlk984t().s[2]++, await pool.getConnection());

    // Get Staff_ID input from the request
    const searchParams = (cov_2honlk984t().s[3]++, request.nextUrl.searchParams);
    const staffID = (cov_2honlk984t().s[4]++, searchParams.get("staffID"));
    cov_2honlk984t().s[5]++;
    console.log("Staff ID:", staffID);

    // Parse the request body to get Arrangement_ID, Request_Status, and Update_Reason
    const {
      Arrangement_ID,
      Request_Status,
      Update_Reason
    } = (cov_2honlk984t().s[6]++, await request.json());

    // Check that all parameters are provided
    cov_2honlk984t().s[7]++;
    if ((cov_2honlk984t().b[1][0]++, !Arrangement_ID) || (cov_2honlk984t().b[1][1]++, !Request_Status) || (cov_2honlk984t().b[1][2]++, !Update_Reason)) {
      cov_2honlk984t().b[0][0]++;
      cov_2honlk984t().s[8]++;
      return NextResponse.json({
        message: "Arrangement_ID, Request_Status, and Update_Reason are required."
      }, {
        status: 400
      } // Use 400 Bad Request for missing parameters
      );
    } else {
      cov_2honlk984t().b[0][1]++;
    }

    // Execute the query to update the Request_Status and Update_Reason
    const [data] = (cov_2honlk984t().s[9]++, await conn.query(`
      UPDATE Arrangement
      SET Request_Status = ?, Update_Reason = ?
      WHERE Arrangement_ID = ?;
      `, [Request_Status, Update_Reason, Arrangement_ID]));

    // Check if any rows were affected (i.e., whether the update was successful)
    cov_2honlk984t().s[10]++;
    if (data.affectedRows === 0) {
      cov_2honlk984t().b[2][0]++;
      cov_2honlk984t().s[11]++;
      conn.release();
      cov_2honlk984t().s[12]++;
      return NextResponse.json({
        message: "No arrangement found with the given Arrangement_ID."
      }, {
        status: 404
      } // Not Found status if no matching Arrangement_ID
      );
    } else {
      cov_2honlk984t().b[2][1]++;
    }

    // ----Preparation for Notification----
    // Get the reporting manager's ID for the current staff
    const managerResult = (cov_2honlk984t().s[13]++, await conn.query(`
      SELECT Reporting_Manager FROM Employee
      WHERE Staff_ID = ?
      `, [staffID]));
    cov_2honlk984t().s[14]++;
    if ((cov_2honlk984t().b[4][0]++, !managerResult) || (cov_2honlk984t().b[4][1]++, managerResult.length === 0)) {
      cov_2honlk984t().b[3][0]++;
      cov_2honlk984t().s[15]++;
      conn.release();
      cov_2honlk984t().s[16]++;
      return NextResponse.json({
        message: `No reporting manager found for staff ID ${staffID}`
      }, {
        status: 404
      });
    } else {
      cov_2honlk984t().b[3][1]++;
    }
    const managerID = (cov_2honlk984t().s[17]++, managerResult[0][0].Reporting_Manager);

    // Get the email of the reporting manager
    const getEmailQuery = (cov_2honlk984t().s[18]++, `
      SELECT Email FROM Employee
      WHERE Staff_ID = ?
    `);
    const emailResult = (cov_2honlk984t().s[19]++, await conn.query(getEmailQuery, [managerID]));
    cov_2honlk984t().s[20]++;
    if ((cov_2honlk984t().b[6][0]++, !emailResult) || (cov_2honlk984t().b[6][1]++, emailResult.length === 0)) {
      cov_2honlk984t().b[5][0]++;
      cov_2honlk984t().s[21]++;
      conn.release();
      cov_2honlk984t().s[22]++;
      return NextResponse.json({
        message: `No email found for reporting manager ID ${managerID}`
      }, {
        status: 404
      });
    } else {
      cov_2honlk984t().b[5][1]++;
    }
    const managerEmail = (cov_2honlk984t().s[23]++, emailResult[0][0].Email);

    // Prepare email content
    const subject = (cov_2honlk984t().s[24]++, "WFH Request Withdrawn");
    const body = (cov_2honlk984t().s[25]++, `Dear Manager/Director,\n\n
    A work-from-home arrangement has been withdrawn:\n\n
    Staff ID: ${staffID}\n
    Withdraw Reason: ${Update_Reason}\n\n
    Please review the request, thank you.\n\n`);

    // Send notification using Mailtrap (or any email service)
    cov_2honlk984t().s[26]++;
    try {
      cov_2honlk984t().s[27]++;
      console.log("Sending email to:", managerEmail);
      cov_2honlk984t().s[28]++;
      await sendNotification(managerEmail, subject, body);
    } catch (emailError) {
      cov_2honlk984t().s[29]++;
      conn.release();
      cov_2honlk984t().s[30]++;
      return NextResponse.json({
        message: "Failed to send notification email."
      }, {
        status: 500
      });
    }
    // ----End of Notification----

    // Release the connection back to the pool
    cov_2honlk984t().s[31]++;
    conn.release();

    // Return success message if withdrawn was successful
    cov_2honlk984t().s[32]++;
    return NextResponse.json({
      message: "Arrangement is successfully withdrawn, and notification sent."
    }, {
      status: 200
    });
  } catch (error) {
    cov_2honlk984t().s[33]++;
    // Handle any errors and return an error response
    return NextResponse.json({
      message: "Internal server error",
      details: error.message
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMmhvbmxrOTg0dCIsImFjdHVhbENvdmVyYWdlIiwiY29ubmVjdGlvbiIsIk5leHRSZXNwb25zZSIsInNlbmROb3RpZmljYXRpb24iLCJQVVQiLCJyZXF1ZXN0IiwiZiIsInMiLCJwb29sIiwiY29ubiIsImdldENvbm5lY3Rpb24iLCJzZWFyY2hQYXJhbXMiLCJuZXh0VXJsIiwic3RhZmZJRCIsImdldCIsImNvbnNvbGUiLCJsb2ciLCJBcnJhbmdlbWVudF9JRCIsIlJlcXVlc3RfU3RhdHVzIiwiVXBkYXRlX1JlYXNvbiIsImpzb24iLCJiIiwibWVzc2FnZSIsInN0YXR1cyIsImRhdGEiLCJxdWVyeSIsImFmZmVjdGVkUm93cyIsInJlbGVhc2UiLCJtYW5hZ2VyUmVzdWx0IiwibGVuZ3RoIiwibWFuYWdlcklEIiwiUmVwb3J0aW5nX01hbmFnZXIiLCJnZXRFbWFpbFF1ZXJ5IiwiZW1haWxSZXN1bHQiLCJtYW5hZ2VyRW1haWwiLCJFbWFpbCIsInN1YmplY3QiLCJib2R5IiwiZW1haWxFcnJvciIsImVycm9yIiwiZGV0YWlscyJdLCJzb3VyY2VzIjpbInJvdXRlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjb25uZWN0aW9uIGZyb20gXCJAL2FwcC9saWIvZGJcIjtcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgc2VuZE5vdGlmaWNhdGlvbiB9IGZyb20gXCJAL2FwcC9saWIvbm90aWZpY2F0aW9uU2VydmljZS5qc1wiO1xuXG4vLyBFeGFtcGxlIEVuZHBvaW50OiBodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL3JlcXVlc3RzL3VwZGF0ZS1zdGF0dXNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQVVQocmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIEVzdGFibGlzaCB0aGUgY29ubmVjdGlvbiB1c2luZyB0aGUgcG9vbFxuICAgIGNvbnN0IHBvb2wgPSBhd2FpdCBjb25uZWN0aW9uKCk7XG4gICAgY29uc3QgY29ubiA9IGF3YWl0IHBvb2wuZ2V0Q29ubmVjdGlvbigpO1xuXG4gICAgLy8gR2V0IFN0YWZmX0lEIGlucHV0IGZyb20gdGhlIHJlcXVlc3RcbiAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSByZXF1ZXN0Lm5leHRVcmwuc2VhcmNoUGFyYW1zO1xuICAgIGNvbnN0IHN0YWZmSUQgPSBzZWFyY2hQYXJhbXMuZ2V0KFwic3RhZmZJRFwiKTtcbiAgICBjb25zb2xlLmxvZyhcIlN0YWZmIElEOlwiLCBzdGFmZklEKTtcblxuICAgIC8vIFBhcnNlIHRoZSByZXF1ZXN0IGJvZHkgdG8gZ2V0IEFycmFuZ2VtZW50X0lELCBSZXF1ZXN0X1N0YXR1cywgYW5kIFVwZGF0ZV9SZWFzb25cbiAgICBjb25zdCB7IEFycmFuZ2VtZW50X0lELCBSZXF1ZXN0X1N0YXR1cywgVXBkYXRlX1JlYXNvbiB9ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICAvLyBDaGVjayB0aGF0IGFsbCBwYXJhbWV0ZXJzIGFyZSBwcm92aWRlZFxuICAgIGlmICghQXJyYW5nZW1lbnRfSUQgfHwgIVJlcXVlc3RfU3RhdHVzIHx8ICFVcGRhdGVfUmVhc29uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogXCJBcnJhbmdlbWVudF9JRCwgUmVxdWVzdF9TdGF0dXMsIGFuZCBVcGRhdGVfUmVhc29uIGFyZSByZXF1aXJlZC5cIiB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH0gLy8gVXNlIDQwMCBCYWQgUmVxdWVzdCBmb3IgbWlzc2luZyBwYXJhbWV0ZXJzXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgdGhlIHF1ZXJ5IHRvIHVwZGF0ZSB0aGUgUmVxdWVzdF9TdGF0dXMgYW5kIFVwZGF0ZV9SZWFzb25cbiAgICBjb25zdCBbZGF0YV0gPSBhd2FpdCBjb25uLnF1ZXJ5KFxuICAgICAgYFxuICAgICAgVVBEQVRFIEFycmFuZ2VtZW50XG4gICAgICBTRVQgUmVxdWVzdF9TdGF0dXMgPSA/LCBVcGRhdGVfUmVhc29uID0gP1xuICAgICAgV0hFUkUgQXJyYW5nZW1lbnRfSUQgPSA/O1xuICAgICAgYCxcbiAgICAgIFtSZXF1ZXN0X1N0YXR1cywgVXBkYXRlX1JlYXNvbiwgQXJyYW5nZW1lbnRfSURdXG4gICAgKTtcblxuICAgIC8vIENoZWNrIGlmIGFueSByb3dzIHdlcmUgYWZmZWN0ZWQgKGkuZS4sIHdoZXRoZXIgdGhlIHVwZGF0ZSB3YXMgc3VjY2Vzc2Z1bClcbiAgICBpZiAoZGF0YS5hZmZlY3RlZFJvd3MgPT09IDApIHtcbiAgICAgIGNvbm4ucmVsZWFzZSgpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IG1lc3NhZ2U6IFwiTm8gYXJyYW5nZW1lbnQgZm91bmQgd2l0aCB0aGUgZ2l2ZW4gQXJyYW5nZW1lbnRfSUQuXCIgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9IC8vIE5vdCBGb3VuZCBzdGF0dXMgaWYgbm8gbWF0Y2hpbmcgQXJyYW5nZW1lbnRfSURcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gLS0tLVByZXBhcmF0aW9uIGZvciBOb3RpZmljYXRpb24tLS0tXG4gICAgLy8gR2V0IHRoZSByZXBvcnRpbmcgbWFuYWdlcidzIElEIGZvciB0aGUgY3VycmVudCBzdGFmZlxuICAgIGNvbnN0IG1hbmFnZXJSZXN1bHQgPSBhd2FpdCBjb25uLnF1ZXJ5KFxuICAgICAgYFxuICAgICAgU0VMRUNUIFJlcG9ydGluZ19NYW5hZ2VyIEZST00gRW1wbG95ZWVcbiAgICAgIFdIRVJFIFN0YWZmX0lEID0gP1xuICAgICAgYCxcbiAgICAgIFtzdGFmZklEXVxuICAgICk7XG5cbiAgICBpZiAoIW1hbmFnZXJSZXN1bHQgfHwgbWFuYWdlclJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbm4ucmVsZWFzZSgpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IG1lc3NhZ2U6IGBObyByZXBvcnRpbmcgbWFuYWdlciBmb3VuZCBmb3Igc3RhZmYgSUQgJHtzdGFmZklEfWAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IG1hbmFnZXJJRCA9IG1hbmFnZXJSZXN1bHRbMF1bMF0uUmVwb3J0aW5nX01hbmFnZXI7XG5cbiAgICAvLyBHZXQgdGhlIGVtYWlsIG9mIHRoZSByZXBvcnRpbmcgbWFuYWdlclxuICAgIGNvbnN0IGdldEVtYWlsUXVlcnkgPSBgXG4gICAgICBTRUxFQ1QgRW1haWwgRlJPTSBFbXBsb3llZVxuICAgICAgV0hFUkUgU3RhZmZfSUQgPSA/XG4gICAgYDtcbiAgICBjb25zdCBlbWFpbFJlc3VsdCA9IGF3YWl0IGNvbm4ucXVlcnkoZ2V0RW1haWxRdWVyeSwgW21hbmFnZXJJRF0pO1xuXG4gICAgaWYgKCFlbWFpbFJlc3VsdCB8fCBlbWFpbFJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbm4ucmVsZWFzZSgpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IG1lc3NhZ2U6IGBObyBlbWFpbCBmb3VuZCBmb3IgcmVwb3J0aW5nIG1hbmFnZXIgSUQgJHttYW5hZ2VySUR9YCB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgbWFuYWdlckVtYWlsID0gZW1haWxSZXN1bHRbMF1bMF0uRW1haWw7XG5cbiAgICAvLyBQcmVwYXJlIGVtYWlsIGNvbnRlbnRcbiAgICBjb25zdCBzdWJqZWN0ID0gXCJXRkggUmVxdWVzdCBXaXRoZHJhd25cIjtcbiAgICBjb25zdCBib2R5ID0gYERlYXIgTWFuYWdlci9EaXJlY3RvcixcXG5cXG5cbiAgICBBIHdvcmstZnJvbS1ob21lIGFycmFuZ2VtZW50IGhhcyBiZWVuIHdpdGhkcmF3bjpcXG5cXG5cbiAgICBTdGFmZiBJRDogJHtzdGFmZklEfVxcblxuICAgIFdpdGhkcmF3IFJlYXNvbjogJHtVcGRhdGVfUmVhc29ufVxcblxcblxuICAgIFBsZWFzZSByZXZpZXcgdGhlIHJlcXVlc3QsIHRoYW5rIHlvdS5cXG5cXG5gO1xuXG4gICAgLy8gU2VuZCBub3RpZmljYXRpb24gdXNpbmcgTWFpbHRyYXAgKG9yIGFueSBlbWFpbCBzZXJ2aWNlKVxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZyhcIlNlbmRpbmcgZW1haWwgdG86XCIsIG1hbmFnZXJFbWFpbCk7XG4gICAgICBhd2FpdCBzZW5kTm90aWZpY2F0aW9uKG1hbmFnZXJFbWFpbCwgc3ViamVjdCwgYm9keSk7XG4gICAgfSBjYXRjaCAoZW1haWxFcnJvcikge1xuICAgICAgY29ubi5yZWxlYXNlKCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogXCJGYWlsZWQgdG8gc2VuZCBub3RpZmljYXRpb24gZW1haWwuXCJ9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICAgIC8vIC0tLS1FbmQgb2YgTm90aWZpY2F0aW9uLS0tLVxuXG4gICAgLy8gUmVsZWFzZSB0aGUgY29ubmVjdGlvbiBiYWNrIHRvIHRoZSBwb29sXG4gICAgY29ubi5yZWxlYXNlKCk7XG5cbiAgICAvLyBSZXR1cm4gc3VjY2VzcyBtZXNzYWdlIGlmIHdpdGhkcmF3biB3YXMgc3VjY2Vzc2Z1bFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgbWVzc2FnZTogXCJBcnJhbmdlbWVudCBpcyBzdWNjZXNzZnVsbHkgd2l0aGRyYXduLCBhbmQgbm90aWZpY2F0aW9uIHNlbnQuXCIgfSxcbiAgICAgIHsgc3RhdHVzOiAyMDAgfVxuICAgICk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgLy8gSGFuZGxlIGFueSBlcnJvcnMgYW5kIHJldHVybiBhbiBlcnJvciByZXNwb25zZVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG1lc3NhZ2U6IFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIsIGRldGFpbHM6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFlWTtJQUFBQSxjQUFBLFlBQUFBLENBQUE7TUFBQSxPQUFBQyxjQUFBO0lBQUE7RUFBQTtFQUFBLE9BQUFBLGNBQUE7QUFBQTtBQUFBRCxjQUFBO0FBZlosT0FBT0UsVUFBVSxNQUFNLGNBQWM7QUFDckMsU0FBU0MsWUFBWSxRQUFRLGFBQWE7QUFDMUMs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